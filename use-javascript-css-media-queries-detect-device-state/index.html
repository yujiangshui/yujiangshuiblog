<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head><meta name="generator" content="Hexo 3.8.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1">
    <meta name="renderer" content="webkit">
    
    <title>JavaScript 依据 CSS Media Queries 判断设备的方法 | 于江水</title>
    <meta name="description" content="能够判断设备的状态是对于 Web APP 的开发来说，是非常重要的。在实际的工作中，往往使用 CSS Media Queries 来判断设备做响应式，而忘记了 JavaScript。JavaScript 判断相关设备并执行不同的功能也是很重要的，本文主要借鉴 David Walsh 写的 Device State Detection with CSS Media Queries and JavaS">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript 依据 CSS Media Queries 判断设备的方法">
<meta property="og:url" content="http://yujiangshui.com/use-javascript-css-media-queries-detect-device-state/index.html">
<meta property="og:site_name" content="于江水">
<meta property="og:description" content="能够判断设备的状态是对于 Web APP 的开发来说，是非常重要的。在实际的工作中，往往使用 CSS Media Queries 来判断设备做响应式，而忘记了 JavaScript。JavaScript 判断相关设备并执行不同的功能也是很重要的，本文主要借鉴 David Walsh 写的 Device State Detection with CSS Media Queries and JavaS">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-04-10T00:17:52.187Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript 依据 CSS Media Queries 判断设备的方法">
<meta name="twitter:description" content="能够判断设备的状态是对于 Web APP 的开发来说，是非常重要的。在实际的工作中，往往使用 CSS Media Queries 来判断设备做响应式，而忘记了 JavaScript。JavaScript 判断相关设备并执行不同的功能也是很重要的，本文主要借鉴 David Walsh 写的 Device State Detection with CSS Media Queries and JavaS">
<meta name="twitter:creator" content="@yujiangshui">
<meta property="fb:admins" content="yujiangshui"> 
    <link rel="alternate" href="/atom.xml" title="于江水" type="application/rss+xml">
    

    <link rel="stylesheet" href="//static.zhjan.com/blog/yujiangshui/assets/jiangshui-simple/0.0.1/css/style.css">
    <script data-main="//static.zhjan.com/blog/yujiangshui/assets/jiangshui-simple/0.0.1/js/build" src="//static.zhjan.com/blog/yujiangshui/assets/jiangshui-simple/0.0.1/js/require.js"></script>
    <!--[if lt IE 7]>
      <style>
        .section {
          width: 780px;
        }
        .post-content img {
          width: 100%;
        }
        .jupe pre {
          width: 100%;
        }
      </style>
    <![endif]-->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-57557739-5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'UA-57557739-5');
    </script>
  </head>
</html>

<body>

<div class="section-wrap section-main">
	<div class="section">
		<div class="header">
	<h1 class="logo">
		<a href="/">于江水</a>
	</h1>
	<p class="social-links">
		<a href="http://www.weibo.com/yujiangshui">Weibo</a>
		\
		<a href="https://twitter.com/yujiangshui">Twitter</a>
		\
		<a href="https://github.com/yujiangshui">Github</a>
		\
		<a href="/atom.xml">RSS</a>
	</p>
</div>
		<div class="main">
			<div class="jupe main-body">
  <div class="post-content">
    <h1 class="post-title">JavaScript 依据 CSS Media Queries 判断设备的方法</h1>
    <div class="post-meta">
      <span class="post-time">2013.12.06</span>
      <div class="post-cats">
        <a class="post-cats-item-link" href="/category/JavaScript/">JavaScript</a>
      </div>
    </div>
    <div class="post-toc">
      <div class="toc-title">TOC</div>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#CSS-部分"><span class="toc-number">1.</span> <span class="toc-text">CSS 部分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaScript-判断"><span class="toc-number">2.</span> <span class="toc-text">JavaScript 判断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#再增强一下"><span class="toc-number">3.</span> <span class="toc-text">再增强一下</span></a></li></ol>
    </div>
    <p>能够判断设备的状态是对于 Web APP 的开发来说，是非常重要的。在实际的工作中，往往使用 CSS Media Queries 来判断设备做响应式，而忘记了 JavaScript。JavaScript 判断相关设备并执行不同的功能也是很重要的，本文主要借鉴 <a href="http://davidwalsh.name/" target="_blank" rel="noopener">David Walsh</a> 写的 <a href="http://davidwalsh.name/device-state-detection-css-media-queries-javascript" target="_blank" rel="noopener">Device State Detection with CSS Media Queries and JavaScript</a> 这篇文章中的思路：通过 CSS Media Queries 改变一个类的某个属性值（例如 <code>z-index</code>）然后用 JavaScript 读取判断，从而实现 JavaScript 判断设备状态执行不同的代码。</p>
<a id="more"></a>
<h2 id="CSS-部分"><a href="#CSS-部分" class="headerlink" title="CSS 部分"></a>CSS 部分</h2><p>首先随便新建一个用来做判断的类，然后通过 Media Queries 来对这个类的 <code>z-index</code> 属性赋予不同的值。这个类仅作为 JavaScript 读取使用，所以需要将其移出屏幕窗口，让浏览者不可见以免引起意外情况。</p>
<p>作为演示，下面代码设置了四种设备状态：桌面普通版、小屏幕桌面版、平板电脑版和手机版。</p>
<pre><code>/* default state */
.state-indicator {
    position: absolute;
    top: -999em;
    left: -999em;

    z-index: 1;
}

/* small desktop */
@media all and (max-width: 1200px) {
    .state-indicator {
        z-index: 2;
    }
}

/* tablet */
@media all and (max-width: 1024px) {
    .state-indicator {
        z-index: 3;
    }
}

/* mobile phone */
@media all and (max-width: 768px) {
    .state-indicator {
        z-index: 4;
    }
}
</code></pre><h2 id="JavaScript-判断"><a href="#JavaScript-判断" class="headerlink" title="JavaScript 判断"></a>JavaScript 判断</h2><p>CSS 已经就位了，那么就需要用 JavaScript 来生成了一个临时的 DOM 对象，然后为它设置对应的类，然后再读取这个对象的 <code>z-index</code> 值。原生的写法如下：</p>
<pre><code>// Create the state-indicator element
var indicator = document.createElement(&apos;div&apos;);
indicator.className = &apos;state-indicator&apos;;
document.body.appendChild(indicator);

// Create a method which returns device state
function getDeviceState() {
    return parseInt(window.getComputedStyle(indicator).getPropertyValue(&apos;z-index&apos;), 10);
}
</code></pre><p><code>getDeviceState()</code> 函数返回的就是 <code>z-index</code> 的值，为了增强一下可读性，可以用 switch 函数来规范输出一下：</p>
<pre><code>function getDeviceState() {
    switch(parseInt(window.getComputedStyle(indicator).getPropertyValue(&apos;z-index&apos;), 10)) {
        case 2:
            return &apos;small-desktop&apos;;
            break;
        case 3:
            return &apos;tablet&apos;;
            break;
        case 4:
            return &apos;phone&apos;;
            break;
        default:
            return &apos;desktop&apos;;
            break;
    }
}
</code></pre><p>这样，就可以用一下代码来判断设备状态，然后执行相应的 JavaScript 代码：</p>
<pre><code>if(getDeviceState() == &apos;tablet&apos;) {
    // 平板电脑下执行的 JavaScript 代码
}
</code></pre><p>这里如果你使用的是 jQuery，直接使用下面代码就可以了：</p>
<pre><code>$(function(){
    $(&apos;body&apos;).append(&apos;&lt;div class=&quot;state-indicator&quot;&gt;&lt;/div&gt;&apos;);

    function getDeviceState() {
        switch(parseInt($(&apos;.state-indicator&apos;).css(&apos;z-index&apos;),10)) {
            case 2:
                return &apos;small-desktop&apos;;
                break;
            case 3:
                return &apos;tablet&apos;;
                break;
            case 4:
                return &apos;phone&apos;;
                break;
            default:
                return &apos;desktop&apos;;
                break;
        }
    }

    console.log(getDeviceState());
    $(&apos;.state-indicator&apos;).remove();
});
</code></pre><p>先创建，然后获取，最后删掉这个节点，具体的设备会在你的控制台中输出，<a href="http://jsfiddle.net/yujiangshui/6A87y/2/" target="_blank" rel="noopener">点击这里查看 Demo</a> ，可以试着拖动一下中间的边框，然后点击 <code>Run</code>。</p>
<h2 id="再增强一下"><a href="#再增强一下" class="headerlink" title="再增强一下"></a>再增强一下</h2><p>上面实现了使用 JavaScript 配合 CSS Media Queries 来检测设备状态，在测试的时候拖动窗口大小，CSS Media Queries 也会随着改变，如果需要 JavaScript 也随之改变，需要监听 <code>resize</code> 事件，不断的进行判断，这里不再赘述。</p>
<p>本文仅作抛砖引玉之用，提供一个简单的思路，你可以根据自己的需求进一步的扩充，比如增加更多的 CSS 属性来进行更加全面详细的判断等等。更多的细节，可以看下 <a href="http://davidwalsh.name/device-state-detection-css-media-queries-javascript" target="_blank" rel="noopener">Device State Detection with CSS Media Queries and JavaScript</a></p>

  </div>
  <div class="post-share">
	<ul class="share-list">
		<li><a class="icon icon-weibo" href="javascript:share.weibo();"><span>weibo</span></a></li>
		<li><a class="icon icon-twitter" href="javascript:share.twitter();"><span>twitter</span></a></li>
		<li><a class="icon icon-douban" href="javascript:share.douban();"><span>douban</span></a></li>
		<li><a class="icon icon-qzone" href="javascript:share.qzone();"><span>qzone</span></a></li>
	</ul>
</div>
</div>
		</div>
		<div class="footer">
	<p class="left">&copy; Jiangshui 一个努力坚持中低质量原创的<a class="color-egg" href="/images/meinanzi.png">美男子</a>。生活不易，<a href="#">包养本人</a>。</p>
	<p class="right">Base on <a href="https://github.com/yujiangshui/jiangshui-simple">Github</a> and <a href="http://hexo.io/">Hexo</a> .</p>
</div>
	</div>
</div>

</body>
</html>